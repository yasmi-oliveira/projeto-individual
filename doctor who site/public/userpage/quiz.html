<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/quiz.css">
    <link rel="stylesheet" href="home.html">
    <link rel="stylesheet" href="../css/style-guia.css">

</head>

<body>

    <header>
        <div class="navbar">
            <div class="logo"> <img onclick="userpage()"
                    src="assets/imags/userlmn_1d29dd8f3801443652fa35798ce71482-removebg-preview (1).png" alt="">
                </a>
            </div>
            <p>|</p>
            <ul>
                <li><a href="home.html">home</a></li>
            </ul>
            <p>|</p>
            <ul>
                <li><a href="guia.html">Guia da série</a></li>
            </ul>
            <p>|</p>
            <ul>
                <li><a href="guia-personagens.html">Guia dos personagens</a> </li>
            </ul>
        </div>
    </header>

    <main>

        <div class="menu" id="home"></div>

        <div class="aviso">
            olá viajante!
            quer testar seus conhecimentos obtidos durante sua estadia nessa nave? <br>
            clique no botao abaixo para iniciar
            <button onclick="jogar()">iniciar quiz</button>
        </div>
        <div class="pagina" style="display: none;">
            <div class="quiz" id="Questao1">
                <h1>Quiz Questão 1</h1>
                <p>Qual é o nome da nave espacial/temporal usada pelo Doutor em Doctor Who?</p>
                <div class="estilo">
                    <div class="respostaestilo" onclick="verificarresposta(1)">TARDIS</div>
                    <div class="respostaestilo" onclick="verificarresposta(0)">Manipulador Vortex</div>
                </div>
                <div class="estilo">
                    <div class="respostaestilo" onclick="verificarresposta(0)">Chave Sônica</div>
                    <div class="respostaestilo" onclick="verificarresposta(0)">Cybermat</div>
                </div>
            </div>

            <div class="quiz" id="Questao2" style="display: none;">
                <h1>Quiz Questão 2</h1>
                <p>Quem foi o primeiro ator a interpretar o Doutor na série original de Doctor Who (1963-1989)?</p>
                <div class="estilo">
                    <div class="respostaestilo" onclick="verificarresposta(0)">David Tennant</div>
                    <div class="respostaestilo" onclick="verificarresposta(0)">Matt Smith</div>
                </div>
                <div class="estilo">
                    <div class="respostaestilo" onclick="verificarresposta(1)">William Hartnell</div>
                    <div class="respostaestilo" onclick="verificarresposta(0)">Tom Baker</div>
                </div>
            </div>


            <div class="quiz" id="Questao3" style="display: none;">
                <h1>Quiz Questão 3</h1>
                <p>Qual é o planeta natal do Doutor na série Doctor Who?</p>
                <div class="estilo">
                    <div class="respostaestilo" onclick="verificarresposta(0)">Marte</div>
                    <div class="respostaestilo" onclick="verificarresposta(1)">Gallifrey</div>
                </div>
                <div class="estilo">
                    <div class="respostaestilo" onclick="verificarresposta(0)">Skaro</div>
                    <div class="respostaestilo" onclick="verificarresposta(0)">Terra</div>
                </div>
            </div>

            <div class="quiz" id="Questao4" style="display: none;">
                <h1>Quiz Questão 4</h1>
                <p>Quem foi o Doutor mais longevo em termos de número de temporadas?</p>
                <div class="estilo">
                    <div class="respostaestilo" onclick="verificarresposta(0)">Décimo Doutor (David Tennant)</div>
                    <div class="respostaestilo" onclick="verificarresposta(1)">Quarto Doutor (Tom Baker)</div>
                </div>
                <div class="estilo">
                    <div class="respostaestilo" onclick="verificarresposta(0)">Décimo Primeiro Doutor (Matt Smith)</div>
                    <div class="respostaestilo" onclick="verificarresposta(0)">Décima Terceira Doutora (Jodie Whittaker)
                    </div>
                </div>
            </div>

            <div class="quiz" id="Questao5" style="display: none;">
                <h1>Quiz Questão 5</h1>
                <p>Qual é o nome do vilão que é conhecido por viajar em uma cabine de polícia azul?</p>
                <div class="estilo">
                    <div class="respostaestilo" onclick="verificarresposta(1)">O Mestre</div>
                    <div class="respostaestilo" onclick="verificarresposta(0)">Daleks</div>
                </div>
                <div class="estilo">
                    <div class="respostaestilo" onclick="verificarresposta(0)">Sontarans</div>
                    <div class="respostaestilo" onclick="verificarresposta(0)">Weeping Angels</div>
                </div>
            </div>

            <div class="quiz" id="Questao6" style="display: none;">
                <h1>Quiz Questão 6</h1>
                <p>Qual é o verdadeiro nome do Doutor?</p>
                <div class="estilo">
                    <div class="respostaestilo" onclick="verificarresposta(1)">Desconhecido</div>
                    <div class="respostaestilo" onclick="verificarresposta(0)">John Smith</div>
                </div>
                <div class="estilo">
                    <div class="respostaestilo" onclick="verificarresposta(0)">Theta Sigma</div>
                    <div class="respostaestilo" onclick="verificarresposta(0)">Rassilon</div>
                </div>
            </div>

            <div class="quiz" id="Questao7" style="display: none;">
                <h1>
                    Seu score total nesta rodada é: <span id="score"></span>
                </h1>

                <h2>Maior pontuação anterior: <span id="maxPontuacao"></span></h2>
                <h2>Menor pontuação anterior: <span id="minPontuacao"></span></h2>

            </div>
        </div>
    </main>
</body>

</html>

<script>

    var username = sessionStorage.getItem("username");

    function jogar() {

        var aviso = document.querySelector(".aviso");
        aviso.style.display = "none";

        var pagina = document.querySelector(".pagina");
        pagina.style.display = "block";
    }
    var minPontuacao = document.getElementById("minPontuacao");
    var maxPontuacao = document.getElementById("maxPontuacao");


    if (username) {
        buscarMinMaxPontuacao(username).then(() => {

        });
    }

    function buscarMinMaxPontuacao(username) {
        return fetch(`/quiz/minmax/${username}`)
            .then(resposta => resposta.json())
            .then(info => {
                minPontuacao.innerHTML = info.minPontuacao;
                maxPontuacao.innerHTML = info.maxPontuacao;
            })
            .catch(erro => console.erro("Erro ao buscar pontuações:", erro));
    }

    function userpage() {
        var menuhome = document.getElementById("home");

        if (menuhome.style.display == "none" || menuhome.style.display == "") {
            menuhome.style.display = "block";

        } else {
            menuhome.style.display = "none";
        }
    }

    var listaresposta = [];
    var respostacorreta = 0;
    var perguntaAtual = 1;

    function mostrarPergunta(perguntaAtual) {
        for (var numero = 1; numero <= 7; numero += 1) {
            var pergunta = document.getElementById("Questao" + numero);
            if (numero == perguntaAtual) {
                pergunta.style.display = "block";
            } else {
                pergunta.style.display = "none";
            }
        }
    }

    function verificarresposta(n) {
        if (n == 1) {
            listaresposta.push(n);
            console.log("resposta correta!");
        } else {
            console.log("resposta errada!");
        }

        respostacorreta = listaresposta.length;

        var username = sessionStorage.getItem("username");

        score.innerHTML = (listaresposta.length);

        if (respostacorreta >= 0) {
            perguntaAtual += 1;
            if (perguntaAtual <= 6) {
                setTimeout(function () {
                    mostrarPergunta(perguntaAtual);
                }, 500);
            } else {
                score.innerHTML = (listaresposta.length);
                fetch("/quiz/adicionar", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        respostacorretaServer: respostacorreta,
                        usernameServer: username
                    }),
                }).then(res => {
                    if (res.ok) {
                        console.log("Pontuações enviadas com sucesso!")
                        mostrarPergunta(7)
                    } else {
                        console.error("Erro ao enviar pontuações:", res)
                    }
                }).catch(erro => {
                    console.error("Erro ao enviar pontuações:", erro)
                });

            }
        }

    }
</script>