<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DW</title>
    <link rel="stylesheet" href="css/style-guia.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>

</head>

<body>

    <header>
        <div class="navbar">
            <div class="logo"> <img onclick="userpage()"
                    src="assets/imags/userlmn_1d29dd8f3801443652fa35798ce71482-removebg-preview (1).png" alt="">
                </a>
            </div>
            <p>|</p>
            <ul>
                <li><a href="home.html">home</a></li>
            </ul>
            <p>|</p>
            <ul>
                <li><a href="guia-personagens.html">Guia dos personagens</a> </li>
            </ul>
            <p>|</p>
            <ul>
                <li> <a href="quiz.html">Quiz</a> </li>
            </ul>
        </div>
    </header>

    <main>
        <div class="margem">
            <div class="valores2" id="temporadaclassica">
                <div class="temporadaum">

                    <div class="tpdois">
                        <img src="assets/imags/classica.jpg" alt="">
                        <div class="informacoes">
                            <div class="titulos">
                                <h1> Temporadas Atuais</h1>
                                <h2>(2005-2023)</h2>
                            </div>
                            <p>Desde sua revitalização em 2005, "Doctor Who" encanta uma nova geração de fãs com suas
                                Temporadas Atuais. Siga o Doutor, interpretado por talentosos atores como Christopher
                                Eccleston, David Tennant, Matt Smith, Peter Capaldi e Jodie Whittaker, enquanto embarcam
                                em aventuras emocionantes pela galáxia. Enfrentando ameaças alienígenas, misteriosos
                                paradoxos temporais e desafios morais, o Doutor continua a ser um farol de esperança e
                                coragem. As temporadas atuais são marcadas por efeitos visuais impressionantes,
                                desenvolvimento de personagens envolvente e uma abordagem contemporânea aos dilemas
                                éticos e científicos. Uma jornada emocionante e inclusiva que mantém viva a tradição
                                única de "Doctor Who".
                            </p>

                            <div class="avaliacao" style="display: flex;">

                                <div class="card" data-pagina-atual="1">
                                    <h3>Avaliação</h3>
                                    <span onclick="estrelinhas(1)" class="estrela">★</span>
                                    <span onclick="estrelinhas(2)" class="estrela">★</span>
                                    <span onclick="estrelinhas(3)" class="estrela">★</span>
                                    <span onclick="estrelinhas(4)" class="estrela">★</span>
                                    <span onclick="estrelinhas(5)" class="estrela">★</span>
                                    <h5 id="avaliacaoatual">Sua avaliação é: 0/5</h5> <br>
                                    <div class="mediaestrelas" id="mediaestrelas" style="font-size: 30px; margin-left: 20px;" ></div>
                                </div>
                                <div class="dashboard"
                                    style="border-radius: 10px; background-color: rgb(169, 173, 177); width: 350px; padding: 15px;">
                                   
                                    quantidade de estrelas por pessoa:
                                    <canvas id="barChart" width="300px" height="170px" style="width: 400px;"></canvas>
                                </div>
                            </div>

                            <h4>Elenco</h4>
                            <div class="linha"></div>


                            <div class="elenco">
                                <ul>
                                    <li>Matt Smith</li>
                                </ul>

                                <ul>
                                    <li>David Tannat</li>
                                </ul>

                                <ul>
                                    <li>Peter Calpadi</li>
                                </ul>

                                <ul>
                                    <li>Jenna Coleman</li>
                                </ul>

                                <ul>
                                    <li>Christopher Eccleston</li>
                                </ul>

                                <ul>
                                    <li>Billie Piper/li>
                                </ul>


                            </div>

                            <div class="elenco">
                                <ul>
                                    <li>Karen Gillan</li>
                                </ul>

                                <ul>
                                    <li>Bradley Walsh</li>
                                </ul>

                                <ul>
                                    <li>Catherine Tate</li>
                                </ul>

                                <ul>
                                    <li>Arthur Davill</li>
                                </ul>

                                <ul>
                                    <li>Alex Kindston</li>
                                </ul>

                                <ul>
                                    <li>Andrew Garfield</li>
                                </ul>


                            </div>
                        </div>

                    </div>

                    <div class="doutores">
                        <h1>
                            doutores:
                        </h1>

                        <div class="doutoresclassicos">

                            <img src="assets/doutores/nono doutor.jpg" alt="">

                            <div class="dcl">
                                <h2>9th doutor</h2>
                                <h3>Christopher Eccleston</h3>

                                <p> <b>Temporadas:</b>1 temporada <br> <br>
                                    <b>Crítica à Guerra e Violência:</b> O Doutor, como o "Doctor da Guerra",
                                    questiona ativamente a utilidade da guerra e da violência como solução para os
                                    problemas. A temporada busca alternativas para resolver conflitos sem recorrer à
                                    destruição.
                                    <br><br>
                                    <b>Eixo-tematico: </b>Trauma e Recuperação: esta temporada nos mostra um doutor pós
                                   guerra, nela ele esta lidando com o trauma e as consequências
                                    psicológicas de suas ações durante a Última Grande Guerra do Tempo. Exploração
                                    profunda do impacto emocional e da busca por cura.
                                </p>
                            </div>

                        </div>

                        <div class="doutoresclassicos2">

                            <img src="assets/doutores/decimo.webp" alt="">

                            <div class="dcl">
                                <h2>10th doutor</h2>
                                <h3>David Tennant</h3>

                                <p> <b>Temporadas:</b> 2 temporada ate a 5 temporada <br><br>
                                    <b>Responsabilidade e Consequências:</b> A narrativa enfatiza a responsabilidade
                                    pessoal, explorando como as ações individuais do Doutor e de seus companheiros podem
                                    ter repercussões significativas. Isso destaca a ideia de que cada escolha importa.
                                    <br><br>
                                    <b>Eixo-tematico: </b>exploração do Luto: Lidar com a perda e o adeus
                                </p>
                            </div>

                        </div>

                        <div class="doutoresclassicos">

                            <img src="assets/doutores/decimoprimmeiro.jpg" alt="">

                            <div class="dcl">
                                <h2>11th doutor</h2>
                                <h3>Matt Smith</h3>
                                <p> <b>Temporadas:</b> 5 temporada ate a 7 temporada <br> <br>
                                    <b>Diversidade e Inclusão:</b> Narrativas que celebram a diversidade e abordam
                                    questões de inclusão, o doutor por varias vezes aborda como a sociedade nao evolui
                                    enquanto há distinção enrtre pessoas<br> <br>
                                    <b>Eixo-tematico: </b>Crítica à Militarização: A presença recorrente da personagem
                                    Missy, uma versão regenerada do Mestre, levanta questões sobre militarização e
                                    estratégias de guerra. A série aborda criticamente o uso da violência e a natureza
                                    destrutiva de conflitos armados.
                                </p>
                            </div>

                        </div>

                        <div class="doutoresclassicos2">

                            <img src="assets/doutores/12.jpg" alt="">

                            <div class="dcl">
                                <h2>12th doutor</h2>
                                <h3>Peter Calpadi</h3>
                                <p> <b>Temporadas:</b> 8 temporada ate a 10 temporada <br><br>
                                    <b>Diversidade e Inclusão:</b> Narrativas que celebram a diversidade e abordam
                                    questões de inclusão, o doutor por varias vezes aborda como a sociedade nao evolui
                                    enquanto há distinção enrtre pessoas<br><br>
                                    <b>Eixo-tematico: </b>Perda de Memórias: Reflexão sobre a importância das memórias
                                    na formação da identidade.
                                </p>
                            </div>

                        </div>

                        <div class="doutoresclassicos">

                            <img src="assets/doutores/doutora.webp" alt="">

                            <div class="dl">
                                <h2>13th doutora</h2>
                                <h3>Jodie Whittaker</h3>

                                <p> <b>Temporadas:</b> 11ºtemporada ate 13ºtemporada<br><br>
                                    <b>Responsabilidade e Consequências:</b> A narrativa enfatiza a responsabilidade
                                    pessoal, explorando como as ações individuais do Doutor e de seus companheiros podem
                                    ter repercussões significativas. Isso destaca a ideia de que cada escolha importa.
                                    <br><br>
                                    <b>Eixo-tematico: </b>exploração do Luto: Lidar com a perda e o adeus
                                </p>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="frase" style="background-color: aliceblue;">
                    <h1>
                        Temporadas
                    </h1>

                    <ul><li><a href="guia2.html"><li> classicas</a></li>
                        <li><a href="guia.html">Temporadas Atuais</a></li>
                    </ul>
                </div>

            </div>

        </div>
        </div>
    </main>

    <footer>
        <p>yasmin angelica</p>
        <h5>email:yasmin@spceh.school</h5>
        <h5>endereço: rua haddock lobo</h5>
        <h5>telefone:</h5>
    </footer>

</body>

</html>

<script>

    //setando o grafico
    const data = {
        labels: ['1 estrela', '2 estrelas', '3 estrelas', '4 estrelas', '5 estrelas'],
        datasets: [{
            label: 'estrelinhas',
            data: [],
            backgroundColor: [
                'rgba(255, 26, 104, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(0, 0, 0, 0.2)'
            ],
            borderColor: [
                'rgba(255, 26, 104, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(0, 0, 0, 1)'
            ],
            borderWidth: 1,
            borderSkipped: false,
            borderRadius: 2,
            barPercentage: 0.8,
            categoryPercentage: 0.9
        }]
    };

    const progressBar = {
        id: 'progressBar',
        beforeDatasetsDraw(chart, args, pluginOptions) {
            const { ctx, data, chartArea: { top, bottom, left, right, width, height },
                scales: { x, y } } = chart;

            data.datasets[0].data.forEach((datapoint, index) => {

                const fontSizeLabel = 17;

                ctx.font = `${fontSizeLabel}px`;
                ctx.fillStyle = 'rgba(0, 0, 0, 1)',
                    ctx.textAlign = 'left',
                    ctx.textBaseLine = 'middle'
                ctx.fillText(data.labels[index], left, y.getPixelForValue(index))

                const fontSizeDatapoint = 17;

                ctx.font = `bolder ${fontSizeDatapoint}px`;
                ctx.fillStyle = 'rgba(0, 0, 0, 1)',
                    ctx.textAlign = 'right'
                ctx.textBaseLine = 'middle'
                ctx.fillText(datapoint, right, y.getPixelForValue(index))
            })

            ctx.save()
        }
    }

    const config = {
        type: 'bar',
        data,
        options: {
            indexAxis: 'y',
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        display: false,
                        drawBorder: false
                    },
                    ticks: {
                        display: false
                    }
                },
                x: {
                    beginAtZero: true,
                    grid: {
                        display: false,
                        drawBorder: false
                    },
                    ticks: {
                        display: false
                    }
                }


            }
        },
        plugins: [progressBar]
    };
    const barChart = new Chart(
        document.getElementById('barChart'),
        config
    );


    var estrela = document.getElementsByClassName("estrela");

    var avaliacaoSelecionada = 0;
    var fkusuario = sessionStorage.getItem("username");


    //comecinho da funcao de avaliacao, to contando e enviando a quantidade de estrelas

    function estrelinhas(n) {
        avaliacaoSelecionada = n;

        var fkusuario = sessionStorage.getItem("username");

        remover();

        for (var contador = 0; contador < n; contador += 1) {
            var cls = "estrela";
            if (n == 1) cls += " primeira";
            else if (n == 2) cls += " segunda";
            else if (n == 3) cls += " terceira";
            else if (n == 4) cls += " quarta";
            else if (n == 5) cls += " quinta";
            estrela[contador].className = cls;
        }

        avaliacaoatual.innerHTML = `Sua avaliação é:  ${n}/5`;

        sessionStorage.setItem("avaliacaoSelecionada", n);

        enviarAvaliacaoAoServidor(avaliacaoSelecionada);
    }


    function enviarAvaliacaoAoServidor(avaliacao) {
        var cardElement = document.querySelector(".card");
        var paginaAtual = parseInt(cardElement.dataset.paginaAtual, 10);

        fetch("/guia/cadastrar-avaliacao", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                avaliacaoSelecionadaServer: avaliacao,
                paginaAtualServer: paginaAtual,
                fkusuarioServer: fkusuario
            }),
        })
            .then(resposta => resposta.json())
            .then(data => {
                console.log("resposta do servidor:", data);
            })
            .catch(erro => {
                console.erro("erro ao enviar avaliação:", erro);
            });
    }

    function remover() {
        for (var contador = 0; contador < 5; contador += 1) {
            estrela[contador].className = "estrela";
        }
    }

    function atualizarGrafico() {
    fetch("/guia/dados-do-grafico")
        .then(resposta => resposta.json())
        .then(json => {
            // aqui to limpando dados existentes
            barChart.data.datasets[0].data = [];
            barChart.data.labels = [];
            // aqui to atualizano para os dados novos (funciona?)
            var totalEstrelas = 0;
            var totalAvaliacoes = 0;

            for (var incremento = 0; incremento < 5; incremento += 1) {
                if (json[incremento]) {
                    const count = json[incremento].count;
                    const avaliacao = json[incremento].avaliacao;

                    totalEstrelas += count * avaliacao;
                    totalAvaliacoes += count;

                    barChart.data.datasets[0].data.push(count);
                    barChart.data.labels.push(`estrelinha ${avaliacao}`);
                }

                const avaliacao = sessionStorage.getItem("avaliacaoSelecionada");

                if (avaliacao) {
                    estrelinhas(parseInt(avaliacao));
                }
            }

         

            var media =0

            if (totalAvaliacoes>0) {

                media= totalEstrelas / totalAvaliacoes 
            }

            const mediaestrelas = document.getElementById("mediaestrelas");

            mediaestrelas.innerHTML = `★ ${media.toFixed(2)}`;

            barChart.update();
        })
        .catch(erro => {
            console.erro("Erro ao atualizar gráfico:", erro);
        });
}

atualizarGrafico();



</script>