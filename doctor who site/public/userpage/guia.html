<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DW</title>
    <link rel="stylesheet" href="css/style-guia.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>

</head>

<body>

    <header>
        <div class="navbar">
            <div class="logo"> <a href="../index.html"><img onclick="userpage()"
                        src="assets/imags/userlmn_1d29dd8f3801443652fa35798ce71482-removebg-preview (1).png" alt="">
                </a>
            </div>
            <p>|</p>
            <ul>
                <li>Guia da série</li>
            </ul>
            <p>|</p>
            <ul>
                <li>Curiosidades</li>
            </ul>
            <p>|</p>
            <ul>
                <li> <a href="quiz.html">Quiz</a> </li>
            </ul>
        </div>
    </header>

    <main>
        <div class="margem">
            <div class="valores2" id="temporadaclassica">
                <div class="temporadaum">

                    <div class="tpdois">
                        <img src="assets/imags/classica.jpg" alt="">
                        <div class="informacoes">
                            <div class="titulos">
                                <h1> Temporadas Clássicas</h1>
                                <h2>(1963-1989)</h2>
                            </div>
                            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Voluptate vel consequatur ea
                                inventore,
                                placeat tempora itaque iste debitis necessitatibus natus quasi, doloribus, optio iusto
                                veniam
                                pariatur perferendis quis saepe soluta?
                            </p>

                            <div class="avaliacao" style="display: flex;">

                                <div class="card" data-pagina-atual="1">
                                    <h3>Avaliação</h3>
                                    <span onclick="estrelinhas(1)" class="star">★</span>
                                    <span onclick="estrelinhas(2)" class="star">★</span>
                                    <span onclick="estrelinhas(3)" class="star">★</span>
                                    <span onclick="estrelinhas(4)" class="star">★</span>
                                    <span onclick="estrelinhas(5)" class="star">★</span>
                                    <h5 id="outputt">Sua avaliação é: 0/5</h5>
                                </div>
                                <div class="dashboard"
                                    style="border-radius: 10px; background-color: rgb(169, 173, 177); width: 350px; padding: 15px;">
                                    <div class="mediaestrelas"></div>
                                    <canvas id="barChart" width="300px" height="170px" style="width: 400px;"></canvas>
                                </div>
                            </div>

                            <h4>Elenco</h4>
                            <div class="linha"></div>


                            <div class="elenco">
                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>


                            </div>

                            <div class="elenco">
                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>


                            </div>

                            <div class="elenco">
                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>

                                <ul>
                                    <li>matt smith</li>
                                </ul>


                            </div>

                        </div>

                    </div>

                    <div class="doutores">
                        <h1>
                            doutores:
                        </h1>

                        <div class="doutoresclassicos">

                            <img src="style/assets/imags/doutores/FirstSereneLongArk-300x300.jpg" alt="">

                            <div class="dcl">
                                <h2>1° doctor</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequatur vitae id
                                    delectus autem quae, odit
                                    aliquam numquam nobis praesentium temporibus. Explicabo possimus dolores est iusto
                                    cupiditate facere
                                    beatae ipsa?</p>
                            </div>

                        </div>

                        <div class="doutoresclassicos2">

                            <img src="style/assets/imags/doutores/FirstSereneLongArk-300x300.jpg" alt="">

                            <div class="dcl">
                                <h2>1° doctor</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequatur vitae id
                                    delectus autem quae, odit
                                    aliquam numquam nobis praesentium temporibus. Explicabo possimus dolores est iusto
                                    cupiditate facere
                                    beatae ipsa?</p>
                            </div>

                        </div>

                        <div class="doutoresclassicos">

                            <img src="style/assets/imags/doutores/FirstSereneLongArk-300x300.jpg" alt="">

                            <div class="dcl">
                                <h2>1° doctor</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequatur vitae id
                                    delectus autem quae, odit
                                    aliquam numquam nobis praesentium temporibus. Explicabo possimus dolores est iusto
                                    cupiditate facere
                                    beatae ipsa?</p>
                            </div>

                        </div>

                        <div class="doutoresclassicos2">

                            <img src="style/assets/imags/doutores/FirstSereneLongArk-300x300.jpg" alt="">

                            <div class="dcl">
                                <h2>1° doctor</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequatur vitae id
                                    delectus autem quae, odit
                                    aliquam numquam nobis praesentium temporibus. Explicabo possimus dolores est iusto
                                    cupiditate facere
                                    beatae ipsa?</p>
                            </div>

                        </div>

                        <div class="doutoresclassicos">

                            <img src="style/assets/imags/doutores/FirstSereneLongArk-300x300.jpg" alt="">

                            <div class="dcl">
                                <h2>1° doctor</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequatur vitae id
                                    delectus autem quae, odit
                                    aliquam numquam nobis praesentium temporibus. Explicabo possimus dolores est iusto
                                    cupiditate facere
                                    beatae ipsa?</p>
                            </div>

                        </div>

                        <div class="doutoresclassicos2">

                            <img src="style/assets/imags/doutores/FirstSereneLongArk-300x300.jpg" alt="">

                            <div class="dcl">
                                <h2>1° doctor</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequatur vitae id
                                    delectus autem quae, odit
                                    aliquam numquam nobis praesentium temporibus. Explicabo possimus dolores est iusto
                                    cupiditate facere
                                    beatae ipsa?</p>
                            </div>

                        </div>

                        <div class="doutoresclassicos">

                            <img src="style/assets/imags/doutores/FirstSereneLongArk-300x300.jpg" alt="">

                            <div class="dcl">
                                <h2>1° doctor</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequatur vitae id
                                    delectus autem quae, odit
                                    aliquam numquam nobis praesentium temporibus. Explicabo possimus dolores est iusto
                                    cupiditate facere
                                    beatae ipsa?</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="frase" style="background-color: aliceblue;">
                    <h1>
                        Temporadas
                    </h1>

                    <ul>
                        <li>temporadas classicas</li>
                        <li>temporada 2</li>
                        <li>temporada 3</li>
                        <li>temporada 4</li>
                        <li>temporada 5</li>
                        <li>temporada 6</li>
                        <li>temporada 7</li>
                        <li>temporada 8</li>
                        <li>temporada 9</li>
                        <li>temporada 10</li>
                        <li>temporada 11</li>
                        <li>temporada 12</li>
                    </ul>
                </div>

            </div>

        </div>
        </div>
    </main>

</body>

</html>

<script>

    //     var data = {
    //         labels: [],
    //         datasets: [{
    //             label: 'Valores',
    //             backgroundColor: 'rgba(75, 192, 192, 0.2)',
    //             borderColor: 'rgba(75, 192, 192, 1)',
    //             borderWidth: 1,

    //             barPercentage: 0.8,
    //             borderSkipped: false,
    //             borderRadius: 3,
    //             categoryPercentage: 0.2
    //         }]
    //     };

    //     const progressbar = {
    //     id: 'progressbar',
    //     beforeDatasetsDraw(chart, args, pluginOptions) {
    //         const { ctx, data, chartArea: { left, scales: { y } } } = chart;
    //         ctx.save();
    //         ctx.font = '12px sans-serif';
    //         ctx.fillStyle = 'rgba(102, 102, 102, 1)';
    //         ctx.textAlign = 'left';
    //         ctx.textBaseline = 'middle';
    //         ctx.fillText(data.labels[0], left + 10, y.getPixelForValue(0));
    //         ctx.restore();
    //     },
    // };

    // var options = {
    //     scales: {
    //         x: {
    //             beginAtZero: true,
    //             grid: {
    //                 display: false,
    //                 drawBorder: false,
    //             },
    //             ticks: {
    //                 display: false,
    //             },
    //         },
    //         y: {
    //             beginAtZero: true,
    //             grid: {
    //                 display: false,
    //                 drawBorder: false,
    //             },
    //             ticks: {
    //                 display: false,
    //             },
    //         },
    //     },
    //     responsive: true,
    //     indexAxis: 'y',
    //     plugins: {
    //         legend: {
    //             display: false,
    //         },
    //     },
    // };

    //     const ctx = document.getElementById('barChart').getContext('2d');
    //     var barChart = new Chart(ctx, {
    //         type: 'bar',
    //         data: data,
    //         options: options
    //     });





    // setup 
    const data = {
        labels: ['1 estrela', '2 estrelas', '3 estrelas', '4 estrelas', '5 estrelas'],
        datasets: [{
            label: 'estrelinhas',
            data: [],
            backgroundColor: [
                'rgba(255, 26, 104, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(0, 0, 0, 0.2)'
            ],
            borderColor: [
                'rgba(255, 26, 104, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)',
                'rgba(0, 0, 0, 1)'
            ],
            borderWidth: 1,
            borderSkipped: false,
            borderRadius: 2,
            barPercentage: 0.8,
            categoryPercentage: 0.9
        }]
    };

    const progressBar = {
        id: 'progressBar',
        beforeDatasetsDraw(chart, args, pluginOptions) {
            const { ctx, data, chartArea: { top, bottom, left, right, width, height },
                scales: { x, y } } = chart;

            data.datasets[0].data.forEach((datapoint, index) => {

                const fontSizeLabel = 17;

                ctx.font = `${fontSizeLabel}px`;
                ctx.fillStyle = 'rgba(0, 0, 0, 1)',
                    ctx.textAlign = 'left',
                    ctx.textBaseLine = 'middle'
                ctx.fillText(data.labels[index], left, y.getPixelForValue(index))

                const fontSizeDatapoint = 17;

                ctx.font = `bolder ${fontSizeDatapoint}px`;
                ctx.fillStyle = 'rgba(0, 0, 0, 1)',
                    ctx.textAlign = 'right'
                ctx.textBaseLine = 'middle'
                ctx.fillText(datapoint, right, y.getPixelForValue(index))


            })

            ctx.save()


        }

    }

    // config 
    const config = {
        type: 'bar',
        data,
        options: {
            indexAxis: 'y',
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        display: false,
                        drawBorder: false
                    },
                    ticks: {
                        display: false
                    }
                },
                x: {
                    beginAtZero: true,
                    grid: {
                        display: false,
                        drawBorder: false
                    },
                    ticks: {
                        display: false
                    }
                }


            }
        },
        plugins: [progressBar]
    };

    // render init block
    const barChart = new Chart(
        document.getElementById('barChart'),
        config
    );

    // // Instantly assign Chart.js version
    // const chartVersion = document.getElementById('chartVersion');
    // chartVersion.innerText = Chart.version;




    var stars = document.getElementsByClassName("star");

    var avaliacaoSelecionada = 0;
    var fkusuario = sessionStorage.getItem("username");

    function estrelinhas(n) {
        avaliacaoSelecionada = n;

        var fkusuario = sessionStorage.getItem("username");

        remove();
        for (var i = 0; i < n; i++) {
            var cls = "star";
            if (n == 1) cls += " one";
            else if (n == 2) cls += " two";
            else if (n == 3) cls += " three";
            else if (n == 4) cls += " four";
            else if (n == 5) cls += " five";
            stars[i].className = cls;
        }
        outputt.innerText = "Sua avaliação é: " + n + "/5";

        sessionStorage.setItem("avaliacaoSelecionada", n);

        enviarAvaliacaoAoServidor(avaliacaoSelecionada);
    }

    function enviarAvaliacaoAoServidor(avaliacao) {
        var cardElement = document.querySelector(".card");
        var paginaAtual = parseInt(cardElement.dataset.paginaAtual, 10);

        fetch("/guia/cadastrar-avaliacao", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                avaliacaoSelecionadaServer: avaliacao,
                paginaAtualServer: paginaAtual,
                fkusuarioServer: fkusuario
            }),
        })
            .then(response => response.json())
            .then(data => {
                console.log("Resposta do servidor:", data);
            })
            .catch(error => {
                console.error("Erro ao enviar avaliação:", error);
            });
    }

    function remove() {
        for (var i = 0; i < 5; i++) {
            stars[i].className = "star";
        }
    }


    // function atualizarGrafico() {
    //     fetch("/guia/dados-do-grafico")
    //         .then(response => response.json()
    //         .then(json => {
    //             console.log(json)
    //             for (var increment = 0; increment < 5; increment++) {
    //                 if (json[increment]) {
    //                     barChart.data.datasets[0].data.push(json[increment].count);
    //                     barChart.data.labels.push(`estrelinha ${json[increment].avaliacao}`);
    //                 }
    //             }
    //             barChart.update()
    //         }))
    // }

    function atualizarGrafico() {
        fetch("/guia/dados-do-grafico")
            .then(response => response.json())
            .then(json => {
                // aqui ta limpando dados existentes
                barChart.data.datasets[0].data = [];
                barChart.data.labels = [];
                // aqui ta atualizano para os dados novos
                for (var increment = 0; increment < 5; increment++) {
                    if (json[increment]) {
                        barChart.data.datasets[0].data.push(json[increment].count);
                        barChart.data.labels.push(`estrelinha ${json[increment].avaliacao}`);
                    }
                    const avaliacao = sessionStorage.getItem("avaliacaoSelecionada");

                    if (avaliacao) {
                        estrelinhas(parseInt(avaliacao));
                    }
              
                }

                    
            })

          
    }

    atualizarGrafico()


</script>