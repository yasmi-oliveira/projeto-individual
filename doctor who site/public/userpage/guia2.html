<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DW</title>
    <link rel="stylesheet" href="./css/style-guia.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <header>
        <div class="navbar">
            <div class="logo"><img src="style/assets/imags/userlmn_1d29dd8f3801443652fa35798ce71482-removebg-preview (1).png" alt=""></div>
            <p>|</p>
            <ul>
                <li>Guia da série</li>
            </ul>
            <p>|</p>
            <ul>
                <li>Curiosidades</li>
            </ul>
            <p>|</p>
            <ul>
                <li> <a href="guia.html">Quiz</a></li>
            </ul>
        </div>
    </header>

    <main>
        <div class="margem">
            <div class="valores2" id="temporadaclassica">
                <div class="temporadaum">
                    <div class="tpdois">
                        <img src="style/assets/imags/classica.jpg" alt="">
                        <div class="informacoes">
                            <div class="titulos">
                                <h1> Temporadas Clássicas</h1>
                                <h2>(1963-1989)</h2>
                            </div>
                            <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Voluptate vel consequatur ea
                                inventore,
                                placeat tempora itaque iste debitis necessitatibus natus quasi, doloribus, optio iusto
                                veniam
                                pariatur perferendis quis saepe soluta?
                            </p>

                            <div class="card" data-pagina-atual="2">
                                <h3>Avaliação</h3>
                                <span onclick="estrelinhas(1)" class="star">★</span>
                                <span onclick="estrelinhas(2)" class="star">★</span>
                                <span onclick="estrelinhas(3)" class="star">★</span>
                                <span onclick="estrelinhas(4)" class="star">★</span>
                                <span onclick="estrelinhas(5)" class="star">★</span>
                                <h5 id="outputt">Sua avaliação é: 0/5</h5>
                            </div>
                            <h4>Elenco</h4>

                            <div class="linha"></div>

                            <div class="elenco">
                                <!-- Seu conteúdo do elenco aqui -->
                            </div>

                            <div class="dashboard">
                                <canvas id="barChart" width="250" height="120"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="doutores">
                        <h1>
                            doutores:
                        </h1>

                        <div class="doutoresclassicos">

                            <div class="dcl">
                                <h2>1° doctor</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequatur vitae id
                                    delectus autem quae, odit
                                    aliquam numquam nobis praesentium temporibus. Explicabo possimus dolores est iusto
                                    cupiditate facere
                                    beatae ipsa?</p>
                            </div>
                    
                        </div>

                        <div class="doutoresclassicos2">

                            <div class="dcl">
                                <h2>1° doctor</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequatur vitae id
                                    delectus autem quae, odit
                                    aliquam numquam nobis praesentium temporibus. Explicabo possimus dolores est iusto
                                    cupiditate facere
                                    beatae ipsa?</p>
                            </div>
                    
                        </div>

                        <div class="doutoresclassicos">

                            <div class="dcl">
                                <h2>1° doctor</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequatur vitae id
                                    delectus autem quae, odit
                                    aliquam numquam nobis praesentium temporibus. Explicabo possimus dolores est iusto
                                    cupiditate facere
                                    beatae ipsa?</p>
                            </div>
                    
                        </div>

                        <div class="doutoresclassicos2">

                        
                            <div class="dcl">
                                <h2>1° doctor</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequatur vitae id
                                    delectus autem quae, odit
                                    aliquam numquam nobis praesentium temporibus. Explicabo possimus dolores est iusto
                                    cupiditate facere
                                    beatae ipsa?</p>
                            </div>
                    
                        </div>

                        <div class="doutoresclassicos">

                

                            <div class="dcl">
                                <h2>1° doctor</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequatur vitae id
                                    delectus autem quae, odit
                                    aliquam numquam nobis praesentium temporibus. Explicabo possimus dolores est iusto
                                    cupiditate facere
                                    beatae ipsa?</p>
                            </div>
                    
                        </div>

                        <div class="doutoresclassicos2">

                            <div class="dcl">
                                <h2>1° doctor</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequatur vitae id
                                    delectus autem quae, odit
                                    aliquam numquam nobis praesentium temporibus. Explicabo possimus dolores est iusto
                                    cupiditate facere
                                    beatae ipsa?</p>
                            </div>
                    
                        </div>

                        <div class="doutoresclassicos">
                            <div class="dcl">
                                <h2>1° doctor</h2>
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consequatur vitae id
                                    delectus autem quae, odit
                                    aliquam numquam nobis praesentium temporibus. Explicabo possimus dolores est iusto
                                    cupiditate facere
                                    beatae ipsa?</p>
                            </div>
                    
                        </div>

                    </div>
                </div>
                <div class="frase">
                    <h1>Temporadas</h1>
                    <ul>
                        <li>temporadas classicas</li>
                        <li>temporada 2</li>
                        <li>temporada 3</li>
                        <li>temporada 4</li>
                        <li>temporada 5</li>
                        <li>temporada 6</li>
                        <li>temporada 7</li>
                        <li>temporada 8</li>
                        <li>temporada 9</li>
                        <li>temporada 10</li>
                        <li>temporada 11</li>
                        <li>temporada 12</li> 
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <script>
        var stars = document.getElementsByClassName("star");

        var avaliacaoSelecionada = 0;
        var fkusuario = sessionStorage.getItem("username");

        function estrelinhas(n) {
            avaliacaoSelecionada = n;

            var fkusuario = sessionStorage.getItem("username");

            remove();
            for (var i = 0; i < n; i++) {
                var cls = "star";
                if (n == 1) cls += " one";
                else if (n == 2) cls += " two";
                else if (n == 3) cls += " three";
                else if (n == 4) cls += " four";
                else if (n == 5) cls += " five";
                stars[i].className = cls;
            }
            outputt.innerText = "Sua avaliação é: " + n + "/5";

            enviarAvaliacaoAoServidor(avaliacaoSelecionada);
        }

        function enviarAvaliacaoAoServidor(avaliacao) {
            var cardElement = document.querySelector(".card");
            var paginaAtual = parseInt(cardElement.dataset.paginaAtual, 10);

            fetch("/guia/cadastrar-avaliacao", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    avaliacaoSelecionadaServer: avaliacao,
                    paginaAtualServer: paginaAtual,
                    fkusuarioServer: fkusuario
                }),
            })
                .then(response => response.json())
                .then(data => {
                    console.log("Resposta do servidor:", data);
                    atualizarGrafico();
                })
                .catch(error => {
                    console.error("Erro ao enviar avaliação:", error);
                });
        }

        function remove() {
            for (var i = 0; i < 5; i++) {
                stars[i].className = "star";
            }
        }

        // Função para atualizar o gráfico
        function atualizarGrafico() {
            fetch("/guia/dados-do-grafico")
                .then(response => response.json())
                .then(data => {
                    // Atualize os dados e rótulos do gráfico
                    barChart.data.labels = data.map(item => item.avaliacao);
                    barChart.data.datasets[0].data = data.map(item => item.count);

                    // Atualize o gráfico
                    barChart.update();
                })
                .catch(error => {
                    console.error("Erro ao buscar dados do gráfico:", error);
                });
        }

        // Configurações do gráfico
        var data = {
            labels: ['', 'Categoria 2', 'Categoria 3', 'Categoria 4', 'Categoria 5'],
            datasets: [{
                label: 'Valores',
                data: [],
                backgroundColor: 'rgba(75, 192, 192, 0.2)', // Cor de fundo
                borderColor: 'rgba(75, 192, 192, 1)', // Cor da borda
                borderWidth: 1 // Largura da borda
            }]
        };

        // Configurações do gráfico
        var options = {
            scales: {
                x: {
                    beginAtZero: true
                },
                y: {
                    beginAtZero: true
                }
            },
            indexAxis: 'y', // Define o eixo como y
            responsive: true
        };

        // Criação do gráfico de barras
        var ctx = document.getElementById('barChart').getContext('2d');
        var barChart = new Chart(ctx, {
            type: 'bar',
            data: data,
            options: options
        });
    </script>

</body>

</html>
